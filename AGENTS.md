# go-go-try - Agent Guide

## Project Overview

**go-go-try** is a TypeScript utility library for error handling inspired by Go's error handling pattern. It provides a functional approach to try/catch operations by returning a tuple `[error, value]` instead of throwing exceptions.

- **Name**: go-go-try
- **Version**: 6.2.0
- **License**: MIT
- **Repository**: thelinuxlich/go-go-try
- **Node.js Requirements**: >= 16

## Technology Stack

- **Language**: TypeScript 5.8.3
- **Build Tool**: [pkgroll](https://github.com/privatenumber/pkgroll) - A zero-config TypeScript package bundler
- **Linter**: [Biome](https://biomejs.dev/) - Fast linter and formatter
- **Test Framework**: [Vitest](https://vitest.dev/) - Vite-native unit test framework
- **Type Testing**: [@ark/attest](https://github.com/arktypeio/arktype) - Runtime type assertions for TypeScript

## Project Structure

```
.
├── src/
│   ├── index.ts        # Main source file - exports goTry, goTryRaw, and utility types
│   └── index.test.ts   # Comprehensive test suite with runtime and type tests
├── dist/               # Build output (generated by pkgroll)
│   ├── index.cjs       # CommonJS build
│   ├── index.mjs       # ES Module build
│   ├── index.d.cts     # CommonJS type definitions
│   └── index.d.mts     # ES Module type definitions
├── .github/workflows/
│   └── main.yml        # CI configuration for GitHub Actions
├── .attest/            # Ark attest cache directory
├── package.json        # Package configuration with dual CJS/ESM exports
├── tsconfig.json       # TypeScript strict configuration
├── vitest.config.ts    # Vitest configuration with type checking enabled
├── setupVitest.ts      # Vitest global setup for @ark/attest
└── README.md           # User-facing documentation
```

## Build and Test Commands

```bash
# Build the project (generates dist/ with CJS, ESM, and type definitions)
npm run build

# Run linting with auto-fix
npm run lint

# Run the full test suite (build + lint + vitest)
npm test
```

The test script is a composite that:
1. Builds the project
2. Runs the linter
3. Executes Vitest tests

## Code Style Guidelines

- **Linter**: Biome is used for linting and formatting
- **Configuration**: Uses Biome's default configuration (no biome.json present)
- **Strict TypeScript**: The `tsconfig.json` enforces strict mode with additional checks:
  - `noUnusedLocals`: true
  - `noUnusedParameters`: true
  - `allowUnreachableCode`: false
  - `noUncheckedIndexedAccess`: true
  - `noFallthroughCasesInSwitch`: true
  - `forceConsistentCasingInFileNames`: true

## Testing Instructions

### Test Structure

Tests are co-located with source code in `src/index.test.ts` using Vitest.

### Test Types

1. **Runtime Tests**: Standard unit tests verifying behavior
2. **Type Tests**: Using `@ark/attest` to verify TypeScript type inference at runtime

### Key Testing Patterns

```typescript
// Runtime test
import { assert, test } from 'vitest'
test('description', () => {
  const result = goTry(() => 'value')
  assert.equal(result[1], 'value')
})

// Type test
import { attest } from '@ark/attest'
test('types are correct', () => {
  const result = goTry('value')
  attest<Result<string, string>>(result)
})
```

### Running Tests

```bash
# Run all tests with type checking
npx vitest run

# Run tests in watch mode (during development)
npx vitest
```

### Global Setup

The `setupVitest.ts` file configures `@ark/attest` for type assertions in tests.

## API Design

### Core Functions

- **`goTry<T>(value)`**: Returns `[string | undefined, T | undefined]` - error is the message string
- **`goTryRaw<T, E>(value)`**: Returns `[E | undefined, T | undefined]` - error is the raw Error object

### Type Helpers

- **`Result<E, T>`**: The tuple type `[E | undefined, T | undefined]`
- **`Success<T>`**: `[undefined, T]`
- **`Failure<E>`**: `[E, undefined]`
- **`isSuccess(result)`**: Type guard to check if result is success
- **`isFailure(result)`**: Type guard to check if result is failure

### Input Handling

Both functions accept:
- Direct values
- Functions (sync or async)
- Promises

## Dual Package Support

The package supports both CommonJS and ESM consumers:

```json
{
  "main": "./dist/index.cjs",
  "module": "./dist/index.mjs",
  "types": "./dist/index.d.mts",
  "exports": {
    "require": { "types": "./dist/index.d.cts", "default": "./dist/index.cjs" },
    "import": { "types": "./dist/index.d.mts", "default": "./dist/index.mjs" }
  }
}
```

## CI/CD

GitHub Actions workflow (`.github/workflows/main.yml`) runs on every push and PR:

- Tests against Node.js versions: 12, 14, 16, 18
- Uses `yarn install` and `yarn test`
- `fail-fast: false` to see results for all Node versions

## Security Considerations

- Zero runtime dependencies - reduces supply chain attack surface
- Dev dependencies are locked via `package-lock.json`
- Uses `type: "module"` for native ESM support

## Development Workflow

1. Make changes to `src/index.ts`
2. Add/update tests in `src/index.test.ts`
3. Run `npm test` to verify build, lint, and tests pass
4. The CI will test against multiple Node.js versions on push

## Notes for AI Agents

- Always run `npm test` after making changes to ensure build, lint, and tests pass
- Type tests with `@ark/attest` are as important as runtime tests
- The library has zero dependencies - avoid adding any
- Maintain dual CJS/ESM compatibility when making changes
- Follow the existing function overload patterns for type inference
- Error handling should preserve the Go-style tuple return pattern
